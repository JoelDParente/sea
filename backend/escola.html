<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Cadastro de Escola — Formulário de Teste</title>
    <style>
      :root {
        --bg: #0f172a;
        --card: #0b1220;
        --accent: #06b6d4;
        --muted: #94a3b8;
        --glass: rgba(255, 255, 255, 0.03);
        --radius: 14px;
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        min-height: 100vh;
        background: linear-gradient(180deg, #071025 0%, #071827 60%);
        color: #e6eef8;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 28px;
      }

      .container {
        width: 100%;
        max-width: 980px;
      }

      header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 18px;
      }
      .logo-badge {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        background: linear-gradient(135deg, var(--accent), #7c3aed);
        display: grid;
        place-items: center;
        font-weight: 700;
        color: #031124;
        box-shadow: 0 6px 18px rgba(7, 22, 39, 0.6);
      }
      h1 {
        font-size: 20px;
        margin: 0;
      }
      p.lead {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
      }

      form.card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: 0 8px 30px rgba(2, 6, 23, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.03);
      }

      .grid {
        display: grid;
        gap: 12px;
      }
      .grid.cols-2 {
        grid-template-columns: 1fr 1fr;
      }
      .grid.cols-3 {
        grid-template-columns: 1fr 1fr 1fr;
      }

      label {
        display: block;
        font-size: 13px;
        color: var(--muted);
        margin-bottom: 6px;
      }
      input[type="text"],
      input[type="email"],
      input[type="tel"],
      input[type="number"],
      select,
      textarea {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        background: var(--glass);
        color: inherit;
        outline: none;
        font-size: 14px;
        transition: box-shadow 0.15s, border-color 0.15s;
      }
      input:focus,
      textarea:focus,
      select:focus {
        box-shadow: 0 6px 18px rgba(6, 182, 212, 0.08);
        border-color: rgba(6, 182, 212, 0.18);
      }

      .row {
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .hint {
        font-size: 12px;
        color: var(--muted);
        margin-top: 6px;
      }

      .file-drop {
        border: 2px dashed rgba(255, 255, 255, 0.03);
        border-radius: 10px;
        padding: 12px;
        text-align: center;
        cursor: pointer;
      }
      .file-drop input {
        display: none;
      }

      .preview {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-top: 8px;
      }
      .preview img {
        width: 84px;
        height: 84px;
        object-fit: cover;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        background: linear-gradient(180deg, #06111a, #071227);
        box-shadow: 0 6px 18px rgba(2, 6, 23, 0.6);
      }

      .actions {
        display: flex;
        gap: 10px;
        margin-top: 16px;
        align-items: center;
      }
      button {
        background: var(--accent);
        color: #021226;
        border: none;
        padding: 10px 14px;
        border-radius: 10px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 8px 20px rgba(6, 182, 212, 0.08);
      }
      button.secondary {
        background: transparent;
        color: var(--muted);
        border: 1px solid rgba(255, 255, 255, 0.04);
      }
      button.ghost {
        background: transparent;
        color: var(--muted);
        border: none;
        text-decoration: underline;
      }

      pre#jsonOut {
        margin-top: 14px;
        padding: 12px;
        border-radius: 10px;
        background: rgba(0, 0, 0, 0.25);
        color: #dbeafe;
        overflow: auto;
        max-height: 220px;
      }

      footer.meta {
        margin-top: 12px;
        font-size: 12px;
        color: var(--muted);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      /* responsive */
      @media (max-width: 820px) {
        .grid.cols-2 {
          grid-template-columns: 1fr;
        }
        .grid.cols-3 {
          grid-template-columns: 1fr;
        }
        .preview img {
          width: 64px;
          height: 64px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo-badge">SEA</div>
        <div>
          <h1>Cadastro de Escola — Formulário de Teste</h1>
          <p class="lead">
            Formulário que corresponde à tabela <code>Escola</code>. Preencha e
            use o botão "Mostrar JSON" para testar.
          </p>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
      </header>

      <form
        id="escolaForm"
        class="card"
        action="#"
        method="post"
        enctype="multipart/form-data"
        novalidate
      >
        <div class="grid cols-2">
          <div>
            <label for="inep"
              >INEP <span style="color: #7dd3fc">↳ max 12</span></label
            >
            <input
              id="inep"
              name="inep"
              type="text"
              maxlength="12"
              placeholder="012345678901"
              autocomplete="off"
            />
            <div class="hint">Código INEP (opcional). Máx. 12 caracteres.</div>
          </div>

          <div>
            <label for="nome_escola">Nome da Escola *</label>
            <input
              id="nome_escola"
              name="nome_escola"
              type="text"
              required
              placeholder="Escola Municipal Exemplo"
            />
          </div>
        </div>

        <div class="grid cols-2" style="margin-top: 12px">
          <div>
            <label for="email">Email *</label>
            <input
              id="email"
              name="email"
              type="email"
              required
              placeholder="contato@escola.edu.br"
            />
          </div>
          <div>
            <label for="telefone">Telefone</label>
            <input
              id="telefone"
              name="telefone"
              type="tel"
              placeholder="(00) 99999-9999"
            />
            <div class="hint">
              Formato livre; tenta formatar automaticamente.
            </div>
          </div>
        </div>

        <hr
          style="
            margin: 14px 0;
            border: none;
            border-top: 1px solid rgba(255, 255, 255, 0.03);
          "
        />

        <div class="grid cols-3">
          <div>
            <label for="estado">Estado</label>
            <input id="estado" name="estado" type="text" placeholder="SP" />
          </div>
          <div>
            <label for="cidade">Cidade</label>
            <input
              id="cidade"
              name="cidade"
              type="text"
              placeholder="São Paulo"
            />
          </div>
          <div>
            <label for="bairro">Bairro</label>
            <input id="bairro" name="bairro" type="text" placeholder="Centro" />
          </div>
        </div>

        <div class="grid cols-2" style="margin-top: 12px">
          <div>
            <label for="rua">Rua</label>
            <input
              id="rua"
              name="rua"
              type="text"
              placeholder="Rua das Flores"
            />
          </div>
          <div>
            <label for="num">Número</label>
            <input id="num" name="num" type="text" placeholder="123" />
          </div>
        </div>

        <div style="margin-top: 14px">
          <label>Logo da Escola</label>
          <div class="row" style="gap: 12px">
            <label
              class="file-drop"
              id="fileDropLabel"
              title="Clique para escolher arquivo"
            >
              <input
                id="logoFile"
                name="logoFile"
                type="file"
                accept="image/*"
              />
              Clique ou arraste para anexar (imagem)
            </label>

            <div style="flex: 1">
              <label
                for="logoUrl"
                style="
                  font-size: 13px;
                  color: var(--muted);
                  margin-bottom: 6px;
                  display: block;
                "
                >ou URL da logo</label
              >
              <input
                id="logoUrl"
                name="logoUrl"
                type="text"
                placeholder="https://..."
              />
              <div class="hint">
                Se ambos forem fornecidos, o arquivo tem prioridade na
                visualização.
              </div>
            </div>
          </div>

          <div
            class="preview"
            id="previewArea"
            aria-live="polite"
            style="display: none"
          >
            <img id="logoPreview" alt="Pré-visualização da logo" src="" />
            <div>
              <div id="previewName" style="font-weight: 600"></div>
              <div id="previewInfo" class="hint"></div>
              <div style="margin-top: 8px">
                <button type="button" class="secondary" id="removeLogoBtn">
                  Remover logo
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="actions">
          <button type="submit">Enviar (simular envio)</button>
          <button type="button" id="showJsonBtn" class="secondary">
            Mostrar JSON (teste)
          </button>
          <button type="button" id="resetBtn" class="ghost">Limpar</button>
        </div>

        <pre id="jsonOut" style="display: none"></pre>

        <footer class="meta">
          <div>
            Timestamp local será gerado no backend. Aqui mostramos o payload de
            teste.
          </div>
          <div style="color: var(--muted)">
            Formato: campos compatíveis com a tabela <code>Escola</code>
          </div>
        </footer>
      </form>
    </div>

    <script>
      (function () {
        const form = document.getElementById("escolaForm");
        const logoFileInput = document.getElementById("logoFile");
        const logoUrlInput = document.getElementById("logoUrl");
        const previewArea = document.getElementById("previewArea");
        const logoPreview = document.getElementById("logoPreview");
        const previewName = document.getElementById("previewName");
        const previewInfo = document.getElementById("previewInfo");
        const removeLogoBtn = document.getElementById("removeLogoBtn");
        const jsonOut = document.getElementById("jsonOut");
        const showJsonBtn = document.getElementById("showJsonBtn");
        const resetBtn = document.getElementById("resetBtn");

        // small telefone formatter
        const telefoneEl = document.getElementById("telefone");
        telefoneEl.addEventListener("input", (e) => {
          const v = e.target.value.replace(/\D/g, "");
          if (!v) return (e.target.value = "");
          if (v.length <= 2) e.target.value = "(" + v;
          else if (v.length <= 6)
            e.target.value = "(" + v.slice(0, 2) + ") " + v.slice(2);
          else if (v.length <= 10)
            e.target.value =
              "(" + v.slice(0, 2) + ") " + v.slice(2, 6) + "-" + v.slice(6);
          else
            e.target.value =
              "(" + v.slice(0, 2) + ") " + v.slice(2, 7) + "-" + v.slice(7, 11);
        });

        // preview file
        logoFileInput.addEventListener("change", (ev) => {
          const file = ev.target.files && ev.target.files[0];
          if (!file) {
            // maybe clear preview if nothing
            if (!logoUrlInput.value) hidePreview();
            return;
          }
          const url = URL.createObjectURL(file);
          logoPreview.src = url;
          previewArea.style.display = "flex";
          previewName.textContent = file.name;
          previewInfo.textContent = `${Math.round(file.size / 1024)} KB • ${
            file.type || "image"
          }`;
        });

        // preview URL
        logoUrlInput.addEventListener("input", (ev) => {
          const url = ev.target.value.trim();
          if (url && !logoFileInput.files.length) {
            logoPreview.src = url;
            previewArea.style.display = "flex";
            previewName.textContent = "Logo via URL";
            previewInfo.textContent = url;
          } else {
            if (!logoFileInput.files.length) hidePreview();
          }
        });

        removeLogoBtn.addEventListener("click", () => {
          logoFileInput.value = "";
          logoUrlInput.value = "";
          hidePreview();
        });

        function hidePreview() {
          previewArea.style.display = "none";
          logoPreview.src = "";
          previewName.textContent = "";
          previewInfo.textContent = "";
        }

        // Reset
        resetBtn.addEventListener("click", () => {
          form.reset();
          hidePreview();
          jsonOut.style.display = "none";
          jsonOut.textContent = "";
        });

        // Prevent default send so the page doesn't navigate; simulate a submit
        form.addEventListener("submit", async (e) => {
          const payload = {
            inep: form.inep.value.trim() || null,
            nome_escola: form.nome_escola.value.trim() || null,
            email: form.email.value.trim() || null,
            telefone: form.telefone.value.trim() || null,
            estado: form.estado.value.trim() || null,
            cidade: form.cidade.value.trim() || null,
            bairro: form.bairro.value.trim() || null,
            rua: form.rua.value.trim() || null,
            num: form.num.value.trim() || null,
            // Logo handling: prefer file (base64) for preview, else URL
            logo: null,
          };

          e.preventDefault();
          // Simple validation
          const nome = form.nome_escola.value.trim();
          const email = form.email.value.trim();
          if (!nome || !email) {
            alert("Preencha pelo menos Nome da Escola e Email.");
            return;
          }

          // Build a FormData (useful if you want to POST to backend)
          const fd = new FormData(form);
          // If both logoFile and logoUrl present, we keep file (already in fd)
          // If only logoUrl present, include it as "logo" field (string)
          if (!logoFileInput.files.length && logoUrlInput.value.trim()) {
            fd.set("logo", logoUrlInput.value.trim());
          }

          // Example: show FormData contents in console (for testing)
          console.group("FormData (para envio)");
          for (const [k, v] of fd.entries()) {
            if (v instanceof File) {
              console.log(k, v.name, "->", v.type, v.size + " bytes");
            } else {
              console.log(k, v);
            }
          }
          console.groupEnd();

          alert(
            'Formulário pronto — ver console para ver o conteúdo de teste.\nOu clique em "Mostrar JSON (teste)" para obter JSON simulando o payload.'
          );

          // --- If you want to actually send to backend as multipart/form-data, uncomment below and set your endpoint URL ---

          // Envia o JSON real ao backend
          try {
            const { data } = await axios.post(
              "/sea/backend/controllers/EscolaController.php",
              payload,
              { headers: { "Content-Type": "application/json" } }
            );

            console.log("✅ Resposta do servidor:", data);
            alert(data.mensagem || "Escola cadastrada com sucesso!");
          } catch (error) {
            console.error("❌ Erro ao enviar:", error);
            const msg =
              error.response?.data?.erro ||
              error.message ||
              "Erro desconhecido no envio.";
            alert("Erro ao enviar os dados: " + msg);
          }
        });

        // Build JSON-like payload for preview (suitable for sending as JSON if you prefer)
        showJsonBtn.addEventListener("click", async () => {
          // Build object
          const payload = {
            inep: form.inep.value.trim() || null,
            nome_escola: form.nome_escola.value.trim() || null,
            email: form.email.value.trim() || null,
            telefone: form.telefone.value.trim() || null,
            estado: form.estado.value.trim() || null,
            cidade: form.cidade.value.trim() || null,
            bairro: form.bairro.value.trim() || null,
            rua: form.rua.value.trim() || null,
            num: form.num.value.trim() || null,
            // Logo handling: prefer file (base64) for preview, else URL
            logo: null,
          };

          if (logoFileInput.files.length) {
            const file = logoFileInput.files[0];
            // convert to base64 for preview (not ideal for production if large)
            payload.logo = await fileToBase64(file);
            payload.logo_filename = file.name;
          } else if (logoUrlInput.value.trim()) {
            payload.logo = logoUrlInput.value.trim();
          }

          jsonOut.style.display = "block";
          jsonOut.textContent = JSON.stringify(payload, null, 2);

          // If you want to convert this JSON to a FormData or send as JSON:
          fetch("/sea/backend/controllers/EscolaController.php", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          console.log(payload);
        });

        function fileToBase64(file) {
          return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = reject;
            reader.readAsDataURL(file);
          });
        }

        // Small UX: support drag/drop on file-drop label
        const fileDrop = document.getElementById("fileDropLabel");
        fileDrop.addEventListener("dragover", (ev) => {
          ev.preventDefault();
          fileDrop.style.opacity = "0.9";
        });
        fileDrop.addEventListener("dragleave", (ev) => {
          fileDrop.style.opacity = "1";
        });
        fileDrop.addEventListener("drop", (ev) => {
          ev.preventDefault();
          fileDrop.style.opacity = "1";
          const dt = ev.dataTransfer;
          if (dt && dt.files && dt.files.length) {
            logoFileInput.files = dt.files;
            const changeEv = new Event("change");
            logoFileInput.dispatchEvent(changeEv);
          }
        });
      })();
    </script>
  </body>
</html>
